---
/**
 * BlogPostLayout Component
 *
 * Layout wrapper for individual blog posts.
 * Includes navigation, footer, and proper styling for post content.
 */

import BaseLayout from './BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';
import SubstackSubscribe from '../components/SubstackSubscribe.astro';

interface Props {
	title: string;
	description: string;
	date: string;
	readingTime: string;
	substackUrl: string;
}

const { title, description, date, readingTime, substackUrl } = Astro.props;

/**
 * Format date for display (e.g., "NOV 02, 2025")
 */
function formatDate(dateStr: string): string {
	const dateObj = new Date(dateStr);
	const month = dateObj.toLocaleString('en-US', { month: 'short' });
	const day = dateObj.getDate().toString().padStart(2, '0');
	const year = dateObj.getFullYear();
	return `${month.toUpperCase()} ${day}, ${year}`;
}

const formattedDate = formatDate(date);
const pageTitle = `${title} | Wash Your Bowls`;
---

<BaseLayout title={pageTitle} description={description}>
	<Navigation />

	<article class="blog-post">
		<header class="blog-post__header">
			<p class="blog-post__meta">{formattedDate} · {readingTime}</p>
			<h1 class="blog-post__title">{title}</h1>
		</header>

		<div class="blog-post__content">
			<slot />
		</div>

		<div class="blog-post__actions">
			<a href={substackUrl} class="blog-post__read-on-substack" target="_blank" rel="noopener noreferrer">
				READ ON SUBSTACK →
			</a>
		</div>

		<SubstackSubscribe />
	</article>

	<Footer />
</BaseLayout>

<style is:global>
	/* Substack Subscription Form Styling - Embedded in Post Content */
	.blog-post__content .subscription-widget-subscribe {
		border: 2px solid #1a1a1a !important;
		background: #f5f5f0 !important;
		padding: 48px !important;
		border-radius: 0 !important;
		margin: 80px auto !important;
		max-width: 720px !important;
		box-shadow: none !important;
	}

	.blog-post__content .subscription-widget-subscribe * {
		font-family: inherit !important;
		box-shadow: none !important;
	}

	.blog-post__content .subscription-widget-subscribe h2,
	.blog-post__content .subscription-widget-subscribe h3,
	.blog-post__content .subscription-widget-subscribe h4 {
		font-size: 24px !important;
		font-weight: 700 !important;
		color: #1a1a1a !important;
		margin-bottom: 16px !important;
		text-align: center !important;
	}

	.blog-post__content .subscription-widget-subscribe p {
		font-size: 16px !important;
		color: #666666 !important;
		line-height: 1.6 !important;
		text-align: center !important;
		margin-bottom: 24px !important;
	}

	.blog-post__content .subscription-widget-subscribe input[type='email'] {
		border: 2px solid #1a1a1a !important;
		background: #f5f5f0 !important;
		padding: 16px 24px !important;
		font-size: 16px !important;
		font-family: inherit !important;
		border-radius: 0 !important;
		color: #1a1a1a !important;
		width: 100% !important;
		box-shadow: none !important;
		outline: none !important;
	}

	.blog-post__content .subscription-widget-subscribe input[type='email']::placeholder {
		color: #666666 !important;
		opacity: 1 !important;
	}

	.blog-post__content .subscription-widget-subscribe input[type='email']:focus {
		outline: 2px solid #a84032 !important;
		outline-offset: 2px !important;
	}

	.blog-post__content .subscription-widget-subscribe button,
	.blog-post__content .subscription-widget-subscribe input[type='submit'] {
		background: #1a1a1a !important;
		color: #f5f5f0 !important;
		border: 2px solid #1a1a1a !important;
		padding: 16px 32px !important;
		font-size: 16px !important;
		font-weight: 700 !important;
		font-family: inherit !important;
		border-radius: 0 !important;
		text-transform: uppercase !important;
		letter-spacing: 0.05em !important;
		cursor: pointer !important;
		transition: all 200ms ease-in-out !important;
		width: 100% !important;
		margin-top: 16px !important;
		box-shadow: none !important;
	}

	.blog-post__content .subscription-widget-subscribe button:hover,
	.blog-post__content .subscription-widget-subscribe input[type='submit']:hover {
		background: #a84032 !important;
		border-color: #a84032 !important;
	}

	.blog-post__content .subscription-widget-subscribe button:focus,
	.blog-post__content .subscription-widget-subscribe input[type='submit']:focus {
		outline: 2px solid #a84032 !important;
		outline-offset: 2px !important;
	}

	/* Mobile Responsive */
	@media (max-width: 768px) {
		.blog-post__content .subscription-widget-subscribe {
			padding: 24px !important;
			margin: 48px auto !important;
		}

		.blog-post__content .subscription-widget-subscribe h2,
		.blog-post__content .subscription-widget-subscribe h3,
		.blog-post__content .subscription-widget-subscribe h4 {
			font-size: 20px !important;
		}

		.blog-post__content .subscription-widget-subscribe input[type='email'] {
			padding: 12px 16px !important;
		}

		.blog-post__content .subscription-widget-subscribe button,
		.blog-post__content .subscription-widget-subscribe input[type='submit'] {
			padding: 12px 24px !important;
		}
	}
</style>

<style>
	/* Blog Post Layout - Mobile First */
	.blog-post {
		padding: calc(var(--nav-height) + var(--spacing-3xl)) var(--container-padding)
			var(--spacing-3xl);
		max-width: 800px;
		margin: 0 auto;
	}

	.blog-post__header {
		text-align: center;
		margin-bottom: var(--spacing-3xl);
		padding-bottom: var(--spacing-xl);
		border-bottom: 2px solid var(--color-border);
	}

	.blog-post__meta {
		font-size: var(--font-size-small);
		font-weight: 500;
		color: var(--color-text-secondary);
		margin-bottom: var(--spacing-lg);
		letter-spacing: 0.05em;
		text-transform: uppercase;
	}

	.blog-post__title {
		font-size: clamp(32px, 8vw, 64px);
		font-weight: 700;
		color: var(--color-text-primary);
		line-height: var(--line-height-tight);
		letter-spacing: -0.02em;
	}

	.blog-post__content {
		font-size: 18px;
		line-height: 1.8;
		color: var(--color-text-primary);
		margin-bottom: var(--spacing-3xl);
	}

	/* Style the blog post content */
	.blog-post__content :global(h2) {
		font-size: 28px;
		font-weight: 700;
		margin: var(--spacing-2xl) 0 var(--spacing-lg);
		line-height: var(--line-height-tight);
		color: var(--color-text-primary);
	}

	.blog-post__content :global(h3) {
		font-size: 24px;
		font-weight: 700;
		margin: var(--spacing-xl) 0 var(--spacing-md);
		line-height: var(--line-height-tight);
		color: var(--color-text-primary);
	}

	.blog-post__content :global(p) {
		margin-bottom: var(--spacing-lg);
		line-height: 1.8;
	}

	.blog-post__content :global(a) {
		color: var(--color-accent);
		text-decoration: underline;
		transition: color var(--transition-base);
	}

	.blog-post__content :global(a:hover) {
		color: var(--color-text-primary);
	}

	.blog-post__content :global(ul),
	.blog-post__content :global(ol) {
		margin-bottom: var(--spacing-lg);
		padding-left: var(--spacing-xl);
	}

	.blog-post__content :global(li) {
		margin-bottom: var(--spacing-sm);
		line-height: 1.8;
	}

	.blog-post__content :global(blockquote) {
		margin: var(--spacing-xl) 0;
		padding: var(--spacing-lg);
		border-left: 4px solid var(--color-accent);
		background-color: rgba(168, 64, 50, 0.05);
		font-style: italic;
	}

	.blog-post__content :global(code) {
		background-color: rgba(26, 26, 26, 0.05);
		padding: 2px 6px;
		border-radius: 3px;
		font-family: 'Courier New', monospace;
		font-size: 0.9em;
	}

	.blog-post__content :global(pre) {
		background-color: rgba(26, 26, 26, 0.05);
		padding: var(--spacing-lg);
		margin-bottom: var(--spacing-lg);
		overflow-x: auto;
		border: 2px solid var(--color-border);
	}

	.blog-post__content :global(pre code) {
		background-color: transparent;
		padding: 0;
	}

	.blog-post__content :global(img) {
		max-width: 100%;
		height: auto;
		margin: var(--spacing-xl) 0;
		border: 2px solid var(--color-border);
	}

	.blog-post__actions {
		text-align: center;
		margin-bottom: var(--spacing-2xl);
		padding-top: var(--spacing-xl);
		border-top: 2px solid var(--color-border);
	}

	.blog-post__read-on-substack {
		display: inline-block;
		padding: var(--spacing-md) var(--spacing-xl);
		background-color: var(--color-bg);
		color: var(--color-text-primary);
		font-weight: 600;
		font-size: var(--font-size-small);
		letter-spacing: 0.05em;
		text-decoration: none;
		border: 2px solid var(--color-border);
		transition: all var(--transition-base);
		text-transform: uppercase;
		min-height: var(--min-touch-target);
		display: inline-flex;
		align-items: center;
		justify-content: center;
	}

	.blog-post__read-on-substack:hover,
	.blog-post__read-on-substack:active {
		background-color: var(--color-hover-bg);
		border-color: var(--color-accent);
	}

	/* Desktop Styles (769px+) */
	@media (min-width: 769px) {
		.blog-post {
			padding-top: calc(var(--nav-height) + 80px);
			padding-bottom: 80px;
		}

		.blog-post__header {
			margin-bottom: 80px;
			padding-bottom: var(--spacing-2xl);
		}

		.blog-post__meta {
			font-size: 14px;
		}

		.blog-post__content {
			font-size: 20px;
			max-width: 720px;
			margin-left: auto;
			margin-right: auto;
		}

		.blog-post__content :global(h2) {
			font-size: 36px;
		}

		.blog-post__content :global(h3) {
			font-size: 28px;
		}

		.blog-post__read-on-substack:active {
			background-color: var(--color-bg);
			border-color: var(--color-border);
		}
	}
</style>
